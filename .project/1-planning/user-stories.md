# User Stories
# Genshin Story QA System

> 版本: 1.0
> 创建日期: 2026-01-27

---

## Story Map Overview

```
                        用户目标
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
    快速回顾剧情      深入研究剧情      连续探索话题
        │                  │                  │
   ┌────┴────┐       ┌────┴────┐       ┌────┴────┐
   │         │       │         │       │         │
 角色查询  事件查询  关系查询  追踪查询  多轮对话  记忆管理
```

---

## Epic 1: 基础事实查询 (MVP)

### US-1.1 角色基本信息查询

**Story**
```
As a 剧情回顾者
I want to 通过角色名查询其基本信息
So that 我能快速回忆起这个角色是谁
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-1.1.1 | 用户输入"伊涅芙是谁" | 系统处理查询 | 返回伊涅芙的身份(秘源机兵)、所属组织、当前状态 |
| AC-1.1.2 | 用户输入"派蒙" | 系统处理查询 | 返回派蒙的角色定位和特征描述 |
| AC-1.1.3 | 用户输入不存在的角色名 | 系统处理查询 | 返回"未找到相关信息"而非编造内容 |

**Test Cases**

```json
[
  {
    "id": "TC-1.1.1",
    "input": "伊涅芙是谁？",
    "expected_keywords": ["秘源机兵", "花羽会", "失忆"],
    "source": "Data/1600/chapter0_dialogue.txt"
  },
  {
    "id": "TC-1.1.2",
    "input": "恰斯卡是什么身份？",
    "expected_keywords": ["巡林官", "花羽会"],
    "source": "Data/1600/"
  }
]
```

---

### US-1.2 地点信息查询

**Story**
```
As a 剧情回顾者
I want to 查询剧情中提到的地点信息
So that 我能了解故事发生的地理背景
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-1.2.1 | 用户询问"花羽会" | 系统处理查询 | 返回花羽会的位置、特点、相关角色 |
| AC-1.2.2 | 用户询问"挪德卡莱" | 系统处理查询 | 返回该地点的描述和相关剧情 |

**Test Cases**

```json
[
  {
    "id": "TC-1.2.1",
    "input": "花羽会是什么地方？",
    "expected_keywords": ["部族", "纳塔"],
    "difficulty": "easy"
  }
]
```

---

### US-1.3 事件概述查询

**Story**
```
As a 剧情回顾者
I want to 查询某个剧情事件的概要
So that 我能了解故事的主要发展
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-1.3.1 | 用户询问"空月之歌讲了什么" | 系统处理查询 | 返回该系列任务的主要剧情概要 |
| AC-1.3.2 | 用户询问某个章节内容 | 系统处理查询 | 返回该章节的主要事件和结局 |

---

### US-1.4 答案来源引用

**Story**
```
As a 剧情研究者
I want to 看到答案的来源出处
So that 我能验证信息的准确性并深入阅读原文
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-1.4.1 | 系统返回任何答案 | 用户查看答案 | 答案包含来源文件和相关章节信息 |
| AC-1.4.2 | 答案来自多个来源 | 用户查看答案 | 列出所有相关来源 |

---

## Epic 2: 关系查询 (v2.0)

### US-2.1 双角色关系查询

**Story**
```
As a 剧情研究者
I want to 查询两个角色之间的关系
So that 我能理解人物之间的联系
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-2.1.1 | 用户询问"恰斯卡和伊涅芙的关系" | 系统处理查询 | 返回两人的关系类型和互动事件 |
| AC-2.1.2 | 用户询问无直接关系的两人 | 系统处理查询 | 返回"两者在剧情中无直接交集"或间接联系 |

**Test Cases**

```json
[
  {
    "id": "TC-2.1.1",
    "input": "恰斯卡和伊涅芙是什么关系？",
    "expected_keywords": ["花羽会", "同伴", "救助"],
    "difficulty": "medium"
  }
]
```

---

### US-2.2 组织成员查询

**Story**
```
As a 剧情研究者
I want to 查询某个组织的所有成员
So that 我能了解组织的构成
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-2.2.1 | 用户询问"花羽会有哪些成员" | 系统处理查询 | 返回花羽会相关的角色列表 |

---

### US-2.3 角色关联网络查询

**Story**
```
As a 剧情研究者
I want to 查询与某角色有交集的所有人物
So that 我能绘制完整的人物关系图
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-2.3.1 | 用户询问"恰斯卡认识哪些人" | 系统处理查询 | 返回与恰斯卡有对话或互动的角色列表 |
| AC-2.3.2 | 返回关联角色 | 用户查看结果 | 每个关联角色标注关系类型 |

---

## Epic 3: 跨章节追踪 (v2.0)

### US-3.1 角色状态追踪

**Story**
```
As a 剧情研究者
I want to 追踪某角色在不同章节中的状态变化
So that 我能理解角色的发展弧线
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-3.1.1 | 用户询问"伊涅芙的失忆在各章节有什么变化" | 系统处理查询 | 按章节顺序返回伊涅芙状态的变化 |
| AC-3.1.2 | 角色状态无变化 | 系统处理查询 | 明确说明该角色状态保持一致 |

---

### US-3.2 事件时间线追踪

**Story**
```
As a 剧情研究者
I want to 追踪某事件在时间线上的发展
So that 我能理解事件的完整脉络
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-3.2.1 | 用户询问"秘源机兵袭击事件的完整经过" | 系统处理查询 | 按时间顺序返回事件的各个阶段 |
| AC-3.2.2 | 事件跨越多个任务 | 系统处理查询 | 整合所有相关任务的信息 |

---

## Epic 4: 多轮对话 (v3.0)

### US-4.1 代词指代消解

**Story**
```
As a 多轮对话用户
I want to 使用"她""他""这个"等代词指代上文实体
So that 我不需要重复输入完整名称
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-4.1.1 | 上轮对话提到"恰斯卡" | 用户问"她是哪个部族的" | 系统正确解析"她"为恰斯卡 |
| AC-4.1.2 | 上轮对话提到多个角色 | 用户使用代词 | 系统根据上下文选择最可能的指代对象 |
| AC-4.1.3 | 代词指代不明确 | 用户使用代词 | 系统请求用户澄清 |

**Test Cases**

```json
[
  {
    "id": "TC-4.1.1",
    "scenario": "单角色指代",
    "turns": [
      {"user": "恰斯卡是谁？", "check": "返回恰斯卡信息"},
      {"user": "她属于哪个部族？", "check": "正确解析为恰斯卡的部族"}
    ]
  }
]
```

---

### US-4.2 上下文延续

**Story**
```
As a 多轮对话用户
I want to 基于之前的对话继续追问
So that 我能深入探索某个话题
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-4.2.1 | 用户已询问伊涅芙的失忆原因 | 用户追问"后来恢复了吗" | 系统理解是关于伊涅芙失忆的后续 |
| AC-4.2.2 | 对话已进行 5 轮 | 用户追问早期话题 | 系统仍能正确关联上下文 |

---

### US-4.3 话题切换识别

**Story**
```
As a 多轮对话用户
I want to 在对话中切换到新话题
So that 我能灵活探索不同内容
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-4.3.1 | 用户之前讨论角色 A | 用户明确询问角色 B | 系统识别为新话题，正确回答 |
| AC-4.3.2 | 用户切换话题后使用代词 | 用户使用"她" | 系统将代词关联到新话题的角色 |

---

### US-4.4 会话记忆持久化

**Story**
```
As a 多轮对话用户
I want to 跨会话保留对话上下文
So that 我下次回来时不需要重新建立上下文
```

**Acceptance Criteria**

| ID | Given | When | Then |
|----|-------|------|------|
| AC-4.4.1 | 用户结束会话 | 用户开始新会话 | 可选择恢复之前的对话上下文 |
| AC-4.4.2 | 用户有多个历史会话 | 用户请求恢复 | 可选择具体要恢复的会话 |

---

## Story Priority Matrix

| Story ID | Story Name | MVP | v2.0 | v3.0 | Priority |
|----------|------------|:---:|:----:|:----:|:--------:|
| US-1.1 | 角色基本信息查询 | ✅ | ✅ | ✅ | P0 |
| US-1.2 | 地点信息查询 | ✅ | ✅ | ✅ | P0 |
| US-1.3 | 事件概述查询 | ✅ | ✅ | ✅ | P0 |
| US-1.4 | 答案来源引用 | ✅ | ✅ | ✅ | P0 |
| US-2.1 | 双角色关系查询 | - | ✅ | ✅ | P1 |
| US-2.2 | 组织成员查询 | - | ✅ | ✅ | P1 |
| US-2.3 | 角色关联网络查询 | - | ✅ | ✅ | P2 |
| US-3.1 | 角色状态追踪 | - | ✅ | ✅ | P1 |
| US-3.2 | 事件时间线追踪 | - | ✅ | ✅ | P1 |
| US-4.1 | 代词指代消解 | - | - | ✅ | P1 |
| US-4.2 | 上下文延续 | - | - | ✅ | P1 |
| US-4.3 | 话题切换识别 | - | - | ✅ | P2 |
| US-4.4 | 会话记忆持久化 | - | - | ✅ | P2 |

---

## Definition of Done (DoD)

每个 User Story 必须满足以下条件才算完成:

- [ ] 所有 Acceptance Criteria 通过验证
- [ ] 相关 Test Cases 编写并通过
- [ ] 代码通过 Code Review
- [ ] 无 Critical/High 级别 Bug
- [ ] 更新评测数据集（如适用）
- [ ] 更新 CHANGELOG.md
