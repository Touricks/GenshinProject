# Product Requirements Document (PRD)
# Genshin Story QA System

> 版本: 1.2
> 创建日期: 2026-01-27
> 状态: Data-Refined Draft

---

## 1. 产品概述

### 1.1 产品愿景

构建一个智能问答平台，让原神玩家能够通过自然语言快速查询和回顾游戏剧情内容，解决"剧情太长记不住"的痛点。

### 1.2 产品定位

| 维度 | 描述 |
|------|------|
| 产品类型 | 私有知识库 RAG 问答系统 |
| 目标领域 | 原神游戏剧情 |
| 核心价值 | 快速、准确、连贯的剧情信息检索 |
| 差异化优势 | 专注中文剧情、支持复杂关系查询、多轮对话记忆 |

### 1.3 业务目标

| 目标 | 指标 | 目标值 |
|------|------|--------|
| 检索准确性 | Recall@5 | ≥ 85% |
| 答案可靠性 | Faithfulness | ≥ 90% |
| 响应速度 | P95 延迟 | < 3s |
| 用户满意度 | 人工评分 | ≥ 4.0/5.0 |

---

## 2. 用户分析

### 2.1 用户画像

#### 画像 A: 剧情回顾者 (Primary)

| 属性 | 描述 |
|------|------|
| 角色 | 休闲玩家、回归玩家 |
| 需求 | 快速回顾之前的剧情，跟上新版本内容 |
| 痛点 | 剧情跨度长，容易遗忘关键细节 |
| 使用场景 | 新版本更新前、观看剧情相关视频时 |
| 典型问题 | "伊涅芙是谁？"、"空月之歌讲了什么？" |

#### 画像 B: 剧情研究者 (Secondary)

| 属性 | 描述 |
|------|------|
| 角色 | 剧情党、考据党、内容创作者 |
| 需求 | 深入分析人物关系、事件脉络、伏笔线索 |
| 痛点 | 手动翻找对话文本效率低 |
| 使用场景 | 撰写剧情分析、制作视频、参与讨论 |
| 典型问题 | "恰斯卡和哪些角色有交集？"、"秘源机兵袭击事件的完整经过？" |

#### 画像 C: 多轮对话者 (Tertiary)

| 属性 | 描述 |
|------|------|
| 角色 | 需要连续探索剧情的用户 |
| 需求 | 通过追问深入了解某个话题 |
| 痛点 | 每次都要重复上下文 |
| 使用场景 | 探索某个角色的完整故事线 |
| 典型问题 | "她后来怎么样了？"、"这个事件和之前说的有什么联系？" |

### 2.2 用户旅程

```
发现需求 → 提出问题 → 获取答案 → 追问/深入 → 满意/离开
    ↓           ↓           ↓            ↓
  想起某个    自然语言    系统检索     多轮对话
  剧情细节    输入问题    并生成答案   保持上下文
```

---

## 3. 用户故事

### 3.1 Epic 1: 基础事实查询

#### US-1.1: 角色信息查询
```
As a 剧情回顾者
I want to 通过角色名查询其基本信息（身份、所属组织、职责等）
So that 我能快速了解或回忆某个角色是谁
```

**验收标准:**
```gherkin
Given 用户输入包含角色名的问题（如"伊涅芙是谁？"）
When 系统处理该查询
Then 返回该角色的身份描述、所属组织、主要特征
And 答案基于原始剧情对话，无虚构内容
And **注意**: 若对话未提及外貌描写，系统应说明"文本中未提及外观信息"，不进行视觉推断
And 响应时间 < 3 秒
```

#### US-1.2: 地点信息查询
```
As a 剧情回顾者
I want to 查询某个地点的相关信息
So that 我能了解剧情发生的背景环境
```

**验收标准:**
```gherkin
Given 用户询问某个地点（如"花羽会是什么地方？"）
When 系统处理该查询
Then 返回该地点的描述、相关角色、发生的事件
And 提供信息来源章节
```

#### US-1.3: 事件概述查询
```
As a 剧情回顾者
I want to 查询某个事件的概要
So that 我能快速了解剧情发展
```

**验收标准:**
```gherkin
Given 用户询问某个事件（如"空月之歌讲了什么？"）
When 系统处理该查询
Then 返回事件的主要经过、涉及角色、结果
And 按时间顺序组织信息

**异常场景:**
```gherkin
Given 用户询问系统知识库中不存在的事件
Then 系统明确告知"未找到相关信息"
And 不编造虚假剧情
```
```

---

### 3.2 Epic 2: 关系查询

#### US-2.1: 人物关系查询
```
As a 剧情研究者
I want to 查询两个角色之间的关系
So that 我能理解角色之间的互动和联系
```

**验收标准:**
```gherkin
Given 用户询问两个角色的关系（如"恰斯卡和伊涅芙是什么关系？"）
When 系统处理该查询
Then 返回两者的关系描述（同事、朋友、敌对等）
And 提供支撑该关系的对话或事件证据
```

#### US-2.2: 组织归属查询
```
As a 剧情研究者
I want to 查询某个角色属于哪个组织
So that 我能理解角色的立场和背景
```

**验收标准:**
```gherkin
Given 用户询问角色的组织归属（如"恰斯卡属于哪个部族？"）
When 系统处理该查询
Then 返回该角色所属的组织名称
And 说明该组织的基本信息
```

#### US-2.3: 关联角色查询
```
As a 剧情研究者
I want to 查询与某角色有交集的所有角色
So that 我能构建完整的人物关系网络
```

**验收标准:**
```gherkin
Given 用户询问某角色的关联角色（如"恰斯卡认识哪些人？"）
When 系统处理该查询
Then 返回与该角色有对话或互动的角色列表
And 简要说明各关系的性质
```

---

### 3.3 Epic 3: 跨章节追踪

#### US-3.1: 角色发展追踪
```
As a 剧情研究者
I want to 追踪某角色在不同章节的发展变化
So that 我能理解角色的成长弧线
```

**验收标准:**
```gherkin
Given 用户询问角色发展（如"伊涅芙的状态在各章节有什么变化？"）
When 系统处理该查询
Then 按章节顺序列出该角色的状态变化
And 标注每个变化对应的章节来源
```

#### US-3.2: 事件脉络追踪
```
As a 剧情研究者
I want to 追踪某事件从起因到结果的完整脉络
So that 我能理解事件的前因后果
```

**验收标准:**
```gherkin
Given 用户询问事件脉络（如"秘源机兵袭击事件的完整经过？"）
When 系统处理该查询
Then 按时间顺序返回事件的起因、经过、结果
And 涵盖跨章节的相关内容
```

---

### 3.4 Epic 4: 多轮对话

#### US-4.1: 指代消解
```
As a 多轮对话者
I want to 使用代词指代上文提到的实体
So that 我不需要重复输入完整名称
```

**验收标准:**
```gherkin
Given 上一轮对话提到了"恰斯卡"
When 用户追问"她是哪个部族的？"
Then 系统正确将"她"解析为"恰斯卡"
And 返回恰斯卡的部族信息
```

#### US-4.2: 上下文延续
```
As a 多轮对话者
I want to 基于前文继续追问
So that 我能深入探索某个话题
```

**验收标准:**
```gherkin
Given 用户已询问"伊涅芙失忆的原因"
When 用户追问"她后来恢复了吗？"
Then 系统理解问题是关于伊涅芙的失忆恢复情况
And 返回相关的后续剧情
```

#### US-4.3: 话题切换
```
As a 多轮对话者
I want to 在对话中切换到新话题
So that 我能灵活地探索不同内容
```

**验收标准:**
```gherkin
Given 用户之前在讨论角色A
When 用户明确询问角色B的信息
Then 系统识别话题切换
And 正确回答关于角色B的问题
```


## 4. 功能需求

### 4.1 功能优先级矩阵

| 功能 | MVP (v1.0) | v2.0 | v3.0 | 优先级 |
|------|:----------:|:----:|:----:|:------:|
| 基础事实查询 | ✅ | ✅ | ✅ | P0 |
| 语义相似度检索 | ✅ | ✅ | ✅ | P0 |
| 答案来源引用 | ✅ | ✅ | ✅ | P0 |
| 简单关系查询 (基于文本) | ✅ | ✅ | ✅ | P1 |
| 复杂关系推理 (基于图谱) | - | ✅ | ✅ | P2 |
| 基础多轮对话 (Simple History) | ✅ | ✅ | ✅ | P1 |
| 知识图谱可视化 | - | ✅ | ✅ | P2 |
| 跨章节追踪 | - | ✅ | ✅ | P1 |
| 高级多轮对话 (Mem0) | - | - | ✅ | P1 |
| 用户偏好记忆 | - | - | ✅ | P2 |
| Web UI (Streamlit) | ✅ | ✅ | ✅ | P1 |
| Web UI (Advanced) | - | - | ✅ | P2 |

### 4.2 非功能需求

| 类别 | 需求 | 目标值 |
|------|------|--------|
| 性能 | 查询响应时间 | P95 < 20s |
| 可靠性 | 服务可用性 | 99% |
| 可扩展性 | 支持数据量 | 100+ 任务对话 |
| 安全性 | 数据存储 | 本地部署，无外传 |
| 兼容性 | 支持中文 | 原生中文处理 |

---

## 5. 范围界定

### 5.1 MVP 范围 (v1.0)

**包含:**
- 基础向量检索问答
- 基础多轮对话 (History Window)
- 简单 Web UI (Streamlit)
- 事实类查询（角色、地点、事件）
- 简单关系查询 (直接提及)
- 基础评测框架

**不包含:**
- 复杂知识图谱 (Neo4j)
- 长期记忆 (Mem0)
- 复杂推理 (跨章节)
- 高级 Web UI
- 用户认证

### 5.2 完整版范围 (v3.0)

**额外包含:**
- Neo4j 知识图谱
- Mem0 多轮对话记忆
- 复杂关系查询
- 跨章节推理
- Web UI
- 评测仪表盘

---